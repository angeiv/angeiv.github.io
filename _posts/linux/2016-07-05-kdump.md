---
layout: post
title: CentOS Kdump
category: Linux
tags: CentOS Linux Kdump
keywords: linux CentOS Kdump
description: 
---

## Installing kdump

yum install kexec-tools

## Configuring the Memory Usage

### Changing Memory Options in GRUB2

Open the `/etc/default/grub` configuration file as `root` using a plain text editor such as vim or Gedit.

In this file, locate the line beginning with `GRUB_CMDLINE_LINUX`. The line will look similar to the following:

```
GRUB_CMDLINE_LINUX="rd.lvm.lv=rhel/swap crashkernel=auto rd.lvm.lv=rhel/root rhgb quiet"
```

Note the highlighted `crashkernel=` option; this is where the reserved memory is configured.

Change the value of the crashkernel= option to the amount of memory you want to reserve. For example, to reserve 128 MB of memory, use the following:

```
crashkernel=128M
```

## Configuring kdump on the Command Line

### Configuring the Core Collector

To reduce the size of the `vmcore` dump file, `kdump` allows you to specify an external application (a core collector) to compress the data, and optionally leave out all irrelevant information. Currently, the only fully supported core collector is `makedumpfile`.

To enable the core collector, as `root`, open the `/etc/kdump.conf` configuration file in a text editor, remove the hash sign (“#”) from the beginning of the `#core_collector makedumpfile -l --message-level 1 -d 31` line, and edit the command line options as described below. 

To enable the dump file compression, add the -c parameter. For example:

```
core_collector makedumpfile -c
```

### Configuring the Default Action

`default reboot`

### Enabling the Service

```
systemctl enable kdump.service
systemctl start kdump.service
```

## Testing the kdump Configuration

```
~]# systemctl is-active kdump
active
```

Then type the following commands at a shell prompt:

```
echo 1 > /proc/sys/kernel/sysrq
echo c > /proc/sysrq-trigger
```

This will force the Linux kernel to crash, and the `address-YYYY-MM-DD-HH:MM:SS/vmcore` file will be copied to the location you have selected in the configuration (that is, to `/var/crash/` by default). 

## Referance
[https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Kernel_Crash_Dump_Guide/chap-installing-configuring-kdump.html](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Kernel_Crash_Dump_Guide/chap-installing-configuring-kdump.html)